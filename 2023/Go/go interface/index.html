<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="十二的编程笔记" href="https://blog.twelveeee.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="十二的编程笔记" href="https://blog.twelveeee.top/atom.xml"><link rel="alternate" type="application/json" title="十二的编程笔记" href="https://blog.twelveeee.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="GO"><link rel="canonical" href="https://blog.twelveeee.top/2023/Go/go%20interface/"><title>Go 接口 - GO - 计算机科学 | Twelveeee = 十二的编程笔记 = hello world</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Go 接口</h1><div class="meta"><span class="item" title="创建时间：2023-09-05 22:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-09-05T22:00:00+08:00">2023-09-05</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Twelveeee</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_27.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_71.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_37.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_10.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_33.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_41.webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computerScience/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computerScience/GO/" itemprop="item" rel="index" title="分类于 GO"><span itemprop="name">GO</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.twelveeee.top/2023/Go/go%20interface/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Twelveeee"><meta itemprop="description" content="hello world, 十二的编程笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="十二的编程笔记"></span><div class="body md" itemprop="articleBody"><h1 id="接口"><a class="anchor" href="#接口">#</a> 接口</h1><p>接口（interface）是多个方法声明集合，代表一种调用契约。</p><p>只要目标类型方法集包含接口声明的全部方法，就视为实现该接口，无需显示声明。当然，单个目标类型可实现多个接口。在设计上，接口解除了显式类型依赖（DIP，依赖倒置），提供面向对象多态性。应该定义小型、灵活及组合性接口（ISP，接口隔离），减少可视方法，屏蔽对象内部结构和实现细节。</p><p>不能有字段。<br>只能声明方法，不能实现。<br>可嵌入其他接口。</p><p>通常以 <code>er</code> 作为名称后缀。<br>空接口（ <code>interface&#123;&#125;</code> , <code>any</code> ）没有任何方法声明。</p><p>接口实现的依据是方法集，所以要区分 <code>T.set</code> 和 <code>*T.set</code> 。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> Xer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">type</span> N <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">var</span> n N</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">// var t Xer = n // ~ N does not implement Xer //  test method has pointer receiver</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">var</span> t Xer <span class="token operator">=</span> <span class="token operator">&amp;</span>n</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>	t<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	t<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>匿名接口可直接用于变量定义，或作为结构字段类型。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> N <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">type</span> node <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	value <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">var</span> t <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token operator">=</span> N<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>	n <span class="token operator">:=</span> node<span class="token punctuation">&#123;</span> value<span class="token punctuation">:</span> t <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	n<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>空接口可被赋值任何对象。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> any <span class="token operator">=</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>     <span class="token comment">// 别名</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">var</span> i any <span class="token operator">=</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	i <span class="token operator">=</span> <span class="token string">"abc"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>注意，接口会复制目标对象，通常以指针替代原始值。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> Xer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">type</span> N <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	x <span class="token builtin">int</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>n N<span class="token punctuation">)</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">return</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// -------------------------</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	n <span class="token operator">:=</span> N<span class="token punctuation">&#123;</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">var</span> x Xer <span class="token operator">=</span> n   <span class="token comment">// copy</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	n<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">200</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 200</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 100</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="匿名嵌入"><a class="anchor" href="#匿名嵌入">#</a> 匿名嵌入</h3><p>像匿名字段那样，嵌入其他接口。目标类型方法集中，必须包含嵌入接口在内的全部方法实现。</p><p>相当于导入（include）声明，非继承。<br>不能嵌入自身或循环嵌入。<br>不允许声明重载（overload）。<br>允许签名相同的声明（并集去重）。<br>鼓励小接口嵌入组合。</p><p>签名包括方法名、参数列表（数量、类型、排列顺序）和返回值，不包括参数名。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> Aer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">type</span> Ber <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token function">ToString</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">type</span> Xer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	Aer</pre></td></tr><tr><td data-num="11"></td><td><pre>	Ber                            <span class="token comment">// 嵌入接口有相同声明。</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">ToString</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>      <span class="token comment">// 签名相同（并集去重）。</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">// ToString () string           // 不允许重载（签名不同）。</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token comment">// ~~~~~~ duplicate method</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">type</span> N <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	i <span class="token operator">:=</span> <span class="token function">Xer</span><span class="token punctuation">(</span>N<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	t <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">.</span><span class="token function">NumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="34"></td><td><pre>   Print:  func(main.N)</pre></td></tr><tr><td data-num="35"></td><td><pre>    Test:  func(main.N)</pre></td></tr><tr><td data-num="36"></td><td><pre>ToString:  func(main.N, string) string</pre></td></tr><tr><td data-num="37"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="类型断言"><a class="anchor" href="#类型断言">#</a> 类型断言</h3><p>类型断言（Type Assertion）是一个使用在接口值上的操作，用于检查接口类型变量所持有的值是否实现了期望的接口或者具体的类型。</p><p>在 Go 语言中类型断言的语法格式如下：</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> x <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    x <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">,</span> ok<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="接口类型转换"><a class="anchor" href="#接口类型转换">#</a> 接口类型转换</h3><p>超集接口（即便非嵌入）可隐式转换为子集，反之不行。</p><p>超集包含子集的全部声明（含嵌入）。<br>和声明顺序无关。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> Aer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">toString</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">type</span> Xer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token function">toString</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">type</span> N <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">toString</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> s <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">var</span> x Xer <span class="token operator">=</span> <span class="token operator">&amp;</span>N<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>     <span class="token comment">// super</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">var</span> a Aer <span class="token operator">=</span> x        <span class="token comment">// sub</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token comment">// var x2 Xer = a // ~ Aer does not implement Xer (missing test method)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token comment">// x2 := Xer(a) //  ~ Aer does not implement Xer    </span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>类型推断将接口还原为原始类型，或判断是否实现了某个更具体的接口类型。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">var</span> x Xer <span class="token operator">=</span> <span class="token operator">&amp;</span>N<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>     <span class="token comment">// super</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">var</span> a Aer <span class="token operator">=</span> x        <span class="token comment">// sub</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 原始类型。</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	n<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> ok<span class="token punctuation">)</span>   <span class="token comment">// true</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 接口。</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	x2<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span>Xer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> ok<span class="token punctuation">)</span>  <span class="token comment">// true</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> e any <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span>  <span class="token comment">// true</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>还可用 <code>switch</code> 语句在多种类型间做出推断匹配，如此空接口就有更多发挥空间。</p><p>未使用变量视为错误。<br>不支持 <code>allthrough</code></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">var</span> i any <span class="token operator">=</span> <span class="token operator">&amp;</span>N<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">switch</span> v <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">case</span> <span class="token boolean">nil</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">case</span> <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">case</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">string</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">case</span> <span class="token operator">*</span>N<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">case</span> Xer<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">default</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">var</span> i any <span class="token operator">=</span> <span class="token operator">&amp;</span>N<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">switch</span> v <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// v declared but not used</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">case</span> <span class="token operator">*</span>N<span class="token punctuation">:</span> <span class="token keyword">fallthrough</span>     <span class="token comment">// fallthrough statement out of place</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">default</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="接口比较"><a class="anchor" href="#接口比较">#</a> 接口比较</h3><p>如实现接口的动态类型支持，可做相等（ <code>==</code> 、 <code>!=</code> ）运算。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">any</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">any</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// println(any(map[string]int&#123;&#125;) == any(map[string]int&#123;&#125;)) // ~ comparing uncomparable type map[string]int</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>允许方式：</strong></p><p>接口类型相同。<br>接口类型不同，但声明完全相同。<br>接口类型是超集或子集。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> Aer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">type</span> Ber <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">type</span> Cer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">type</span> Xer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">type</span> N <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span> x <span class="token builtin">int</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	a<span class="token punctuation">,</span> b <span class="token operator">:=</span> N<span class="token punctuation">&#123;</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> N<span class="token punctuation">&#123;</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span>               <span class="token comment">// true</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token comment">// 相同类型接口。</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">Aer</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token operator">==</span> <span class="token function">Aer</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// true</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">Aer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Aer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// false</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token comment">// 不同接口类型，但声明相同（或超集）。</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">Aer</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Ber</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// true</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">Aer</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Xer</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// true</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token comment">// 不同接口类型，声明不同。</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token comment">// println(Aer(a) == Cer(b)) // ~ mismatched types Aer and Cer</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token comment">// 对象和它实现的接口类型（b impl Aer）。</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">Aer</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> b<span class="token punctuation">)</span>          <span class="token comment">// true</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>接口内部由两个字段组成： <code>itab</code> 和 <code>data</code> 。<br>只有两字段都为 <code>nil</code> 时，接口才等于 <code>nil</code> 。可利用反射完善判断结果。<br>不能直接以指针判断，因为编译器可能将其指向 <code>runtime.zerobase</code> 或 <code>zeroVal</code> 全局变量。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> n <span class="token operator">*</span>N</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> x Xer <span class="token operator">=</span> n      <span class="token comment">// type != nil</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">println</span><span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>  <span class="token comment">// false</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">println</span><span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">var</span> t1 any                  <span class="token comment">// type == nil</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">var</span> t2 any <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>   <span class="token comment">// type != nil</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>t1 <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>  <span class="token comment">// true</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>t2 <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>  <span class="token comment">// false</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>t1 <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// true</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>t2 <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// true</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="接口实现"><a class="anchor" href="#接口实现">#</a> 接口实现</h2><p>接口本身一样是静态类型，内部使用 <code>itab</code> 结构存储运行期所需的相关类型信息。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// runtime/runtime2.go</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">type</span> iface <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	tab  <span class="token operator">*</span>itab            <span class="token comment">// 类型和方法表。</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	data unsafe<span class="token punctuation">.</span>Pointer   <span class="token comment">// 目标对象指针。</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">type</span> itab <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	inter <span class="token operator">*</span>interfacetype  <span class="token comment">// 接口类型。  </span></pre></td></tr><tr><td data-num="9"></td><td><pre>	_type <span class="token operator">*</span>_type          <span class="token comment">// 目标类型。</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	hash  <span class="token builtin">uint32</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token boolean">_</span>     <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token builtin">byte</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    fun   <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token builtin">uintptr</span>      <span class="token comment">// 方法表。 offset: 24, 0x18</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>内部实现</strong></p><p>输出编译结果，查看接口结构存储的具体内容。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> Mer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">type</span> Ner <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	Mer</pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token function">B</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token function">C</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">type</span> N <span class="token builtin">int</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">func</span>  <span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span> <span class="token function">C</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">var</span> n N</pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">var</span> t Ner <span class="token operator">=</span> <span class="token operator">&amp;</span>n</pre></td></tr><tr><td data-num="21"></td><td><pre>	t<span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code class="language-Bash">$ go build -gcflags &quot;-N -l -S&quot;

&quot;&quot;.main STEXT
  LEAQ	go.itab.*&quot;&quot;.N,&quot;&quot;.Ner(SB), SI

go.itab.*&quot;&quot;.N,&quot;&quot;.Ner SRODATA
	0x0000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
	0x0010 57 9a 14 c4 00 00 00 00 00 00 00 00 00 00 00 00
	0x0020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
	rel  0+8 t=1       type.&quot;&quot;.Ner+0
	rel  8+8 t=1       type.*&quot;&quot;.N+0
	rel 24+8 t=-32767  &quot;&quot;.(*N).A+0
	rel 32+8 t=-32767  &quot;&quot;.(*N).B+0
	rel 40+8 t=-32767  &quot;&quot;.(*N).C+0
# 不含接口未声明的 *N.D 
</code></pre><p>编译器将接口和目标类型组合，生成实例（ <code>go.itab.*&quot;&quot;.N,&quot;&quot;.Ner</code> ）。<br>其中有接口和目标类型引用，并在方法表（24, 0x18）静态填入具体方法地址。</p><p>前文提及，接口有个重要特征：赋值给接口时，会复制目标对象。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">var</span> n N <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	</pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">var</span> t1 Mer <span class="token operator">=</span> n   <span class="token comment">// copy n</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	t1<span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">var</span> t2 Ner <span class="token operator">=</span> <span class="token operator">&amp;</span>n  <span class="token comment">// copy ptr</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	t2<span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code class="language-Bash">(gdb) info locals

t1 = &#123;
  tab = 0x477d38 &lt;N,main.Mer&gt;,
  data = 0xc000032730            // data = &amp;n_copy
&#125;

t2 = &#123;
  tab = 0x477d78 &lt;N,main.Ner&gt;,
  data = 0xc000032728            // data = &amp;n
&#125;

n = 100

(gdb) p/x &amp;n
$1 = 0xc000032728

(gdb) x/1xg 0xc000032730        ; t1.data。
0xc000032730:   0x0000000000000064
</code></pre><p>因不可寻址（unaddressable），故无法修改接口内部存储的复制品。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">var</span> n N <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token comment">// var t1 Mer = n</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">// p := &amp;(t1.(N)) // ~ cannot take address</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">var</span> t2 Ner <span class="token operator">=</span> <span class="token operator">&amp;</span>n    <span class="token comment">// 接口存储的是指针。</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token operator">*</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">200</span>   <span class="token comment">// 透过指针修改目标对象。</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 200</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>动态调用</strong></p><p>以接口调用方法，需通过方法表动态完成。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//go:noinline</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>n Ner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	n<span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">var</span> n N <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">var</span> i Ner <span class="token operator">=</span> <span class="token operator">&amp;</span>n</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token function">test</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 相比动态调用，内存逃逸才是接口导致的最大性能问题。</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>$ go build <span class="token parameter variable">-gcflags</span> <span class="token string">"-m"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    moved to heap: n</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>$ go tool objdump <span class="token parameter variable">-S</span> <span class="token parameter variable">-s</span> <span class="token string">"main\.main"</span> ./test</pre></td></tr><tr><td data-num="8"></td><td><pre>func <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        var n N <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  0x455294    LEAQ 0x5d45<span class="token punctuation">(</span>IP<span class="token punctuation">)</span>, AX</pre></td></tr><tr><td data-num="11"></td><td><pre>  0x45529b    NOPL <span class="token number">0</span><span class="token punctuation">(</span>AX<span class="token punctuation">)</span><span class="token punctuation">(</span>AX*1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  0x4552a0    CALL runtime.newobject<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>  <span class="token punctuation">;</span> heap alloc</pre></td></tr><tr><td data-num="13"></td><td><pre>  0x4552a5    MOVQ <span class="token variable">$0x64</span>, <span class="token number">0</span><span class="token punctuation">(</span>AX<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  </pre></td></tr><tr><td data-num="15"></td><td><pre>        test<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  0x4552ac    MOVQ AX, BX                 <span class="token punctuation">;</span> .data</pre></td></tr><tr><td data-num="17"></td><td><pre>  0x4552af    LEAQ go.itab.*main.N,main.Ner<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, AX</pre></td></tr><tr><td data-num="18"></td><td><pre>  0x4552b6    CALL main.test<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>$ go tool objdump <span class="token parameter variable">-S</span> <span class="token parameter variable">-s</span> <span class="token string">"main\.test"</span> ./test</pre></td></tr><tr><td data-num="23"></td><td><pre>func test<span class="token punctuation">(</span>n Ner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        n.B<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  0x45523e    MOVQ 0x20<span class="token punctuation">(</span>AX<span class="token punctuation">)</span>, CX  <span class="token punctuation">;</span> .itab + <span class="token number">32</span> -<span class="token operator">></span> B<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  0x455242    MOVQ BX, AX        <span class="token punctuation">;</span> .data</pre></td></tr><tr><td data-num="27"></td><td><pre>  0x455245    MOVL <span class="token variable">$0x9</span>, BX      <span class="token punctuation">;</span> argument</pre></td></tr><tr><td data-num="28"></td><td><pre>  0x45524a    CALL CX            <span class="token punctuation">;</span> B<span class="token punctuation">(</span>.data, 0x9<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>编译器尝试以内联等方式优化，消除（或减少）因动态调用和内存逃逸导致的性能问题。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>n Ner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    n<span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">var</span> n N <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">var</span> i Ner <span class="token operator">=</span> <span class="token operator">&amp;</span>n</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">test</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>优化后的代码，完全抹掉了接口的痕迹（内存逃逸和动态调用）。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ go build <span class="token parameter variable">-gcflags</span> <span class="token string">"-m"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    can inline <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    can inline main</pre></td></tr><tr><td data-num="4"></td><td><pre>    inlining call to <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>$ go tool objdump <span class="token parameter variable">-S</span> <span class="token parameter variable">-s</span> <span class="token string">"main\.main"</span> ./test</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>func <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        var n N <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  0x455234    MOVQ <span class="token variable">$0x64</span>, 0x10<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        n.B<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  0x45523e    LEAQ 0x10<span class="token punctuation">(</span>SP<span class="token punctuation">)</span>, AX</pre></td></tr><tr><td data-num="14"></td><td><pre>  0x455243    MOVL <span class="token variable">$0x9</span>, BX</pre></td></tr><tr><td data-num="15"></td><td><pre>  0x455248    CALL main.<span class="token punctuation">(</span>*N<span class="token punctuation">)</span>.B<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="接口技巧"><a class="anchor" href="#接口技巧">#</a> 接口技巧</h2><p>让编译器检查，确保类型实现了指定接口。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> X <span class="token builtin">int</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">var</span> <span class="token boolean">_</span> fmt<span class="token punctuation">.</span>Stringer <span class="token operator">=</span> <span class="token function">X</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// ~ X does not implement fmt.Stringer (missing String method)</span></pre></td></tr></table></figure><p>定义函数类型，包装函数，使其实现特定接口。</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">type</span> FuncString <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>f FuncString<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>	f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token keyword">return</span> <span class="token string">"hello, world!"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">var</span> t fmt<span class="token punctuation">.</span>Stringer <span class="token operator">=</span> <span class="token function">FuncString</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/GO/" rel="tag"><i class="ic i-tag"></i> GO</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2026-02-03 00:46:46" itemprop="dateModified" datetime="2026-02-03T00:46:46+08:00">2026-02-03</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Twelveeee <i class="ic i-at"><em>@</em></i>十二的编程笔记</li><li class="link"><strong>本文链接：</strong> <a href="https://blog.twelveeee.top/2023/Go/go%20interface/" title="Go 接口">https://blog.twelveeee.top/2023/Go/go interface/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/Go/go%20method/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;twelveeee-note.oss-cn-beijing.aliyuncs.com&#x2F;Image&#x2F;img&#x2F;bgimg_36.webp" title="Go 方法"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> GO</span><h3>Go 方法</h3></a></div><div class="item right"><a href="/2023/Go/go%20generic/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;twelveeee-note.oss-cn-beijing.aliyuncs.com&#x2F;Image&#x2F;img&#x2F;bgimg_96.webp" title="Go 泛型"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> GO</span><h3>Go 泛型</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.</span> <span class="toc-text">接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E5%B5%8C%E5%85%A5"><span class="toc-number">1.0.1.</span> <span class="toc-text">匿名嵌入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">1.0.2.</span> <span class="toc-text">类型断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.0.3.</span> <span class="toc-text">接口类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%AF%94%E8%BE%83"><span class="toc-number">1.0.4.</span> <span class="toc-text">接口比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">接口实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%8A%80%E5%B7%A7"><span class="toc-number">1.2.</span> <span class="toc-text">接口技巧</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2023/Go/go%20statement/" rel="bookmark" title="Go 语句">Go 语句</a></li><li><a href="/2023/Go/go%20type/" rel="bookmark" title="Go 类型">Go 类型</a></li><li><a href="/2023/Go/go%20function/" rel="bookmark" title="Go 函数">Go 函数</a></li><li><a href="/2023/Go/go%20built-in%20data%20types/" rel="bookmark" title="Go 内置数据类型">Go 内置数据类型</a></li><li><a href="/2023/Go/go%20method/" rel="bookmark" title="Go 方法">Go 方法</a></li><li class="active"><a href="/2023/Go/go%20interface/" rel="bookmark" title="Go 接口">Go 接口</a></li><li><a href="/2023/Go/go%20generic/" rel="bookmark" title="Go 泛型">Go 泛型</a></li><li><a href="/2023/Go/go%20concurrency/" rel="bookmark" title="Go 并发">Go 并发</a></li><li><a href="/2023/Go/go%20package/" rel="bookmark" title="Go 包管理">Go 包管理</a></li><li><a href="/2023/Go/go%20test/" rel="bookmark" title="Go 测试">Go 测试</a></li><li><a href="/2023/Go/Lib/zerolog/" rel="bookmark" title="Go zerolog 使用">Go zerolog 使用</a></li><li><a href="/2023/Go/go%20goroutine%20quicksort/" rel="bookmark" title="Go 协程实现快排">Go 协程实现快排</a></li><li><a href="/2023/Go/go%20GMP%20intro/" rel="bookmark" title="goroutine 调度器">goroutine 调度器</a></li><li><a href="/2023/Go/go%20GC%20v1/" rel="bookmark" title="Go 三色标记GC详解">Go 三色标记GC详解</a></li><li><a href="/2023/Go/go%20escape%20analysis/" rel="bookmark" title="Go 逃逸分析">Go 逃逸分析</a></li><li><a href="/2023/Go/Lib/io/" rel="bookmark" title="Go 标准库源码解析-IO操作">Go 标准库源码解析-IO操作</a></li><li><a href="/2023/Go/Lib/strings/" rel="bookmark" title="Go 标准库源码解析-文本操作">Go 标准库源码解析-文本操作</a></li><li><a href="/2023/Go/Lib/sort_and_container/" rel="bookmark" title="Go 标准库源码解析-sort和container">Go 标准库源码解析-sort和container</a></li><li><a href="/2023/Go/go_goroutine_quicksort_v2/" rel="bookmark" title="Go 协程实现快排 V2">Go 协程实现快排 V2</a></li><li><a href="/2023/Go/Lib/urfave_cli/" rel="bookmark" title="Go urfave cli 使用">Go urfave cli 使用</a></li><li><a href="/2023/Go/Lib/time/" rel="bookmark" title="Go 标准库源码解析-Time">Go 标准库源码解析-Time</a></li><li><a href="/2025/Go/go_version_control/" rel="bookmark" title="golang 多版本环境控制">golang 多版本环境控制</a></li><li><a href="/2025/Go/Lib/context/" rel="bookmark" title="golang 标准库源码解析 - Context">golang 标准库源码解析 - Context</a></li><li><a href="/2025/Go/Lib/channel/" rel="bookmark" title="golang 标准库源码解析 - channel">golang 标准库源码解析 - channel</a></li><li><a href="/2025/Go/Lib/runtime2/" rel="bookmark" title="golang 标准库源码解析 - runtime2 GMP">golang 标准库源码解析 - runtime2 GMP</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Twelveeee" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Twelveeee</p><div class="description" itemprop="description">十二的编程笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">124</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">31</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">26</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R3ZWx2ZWVlZQ==" title="https:&#x2F;&#x2F;github.com&#x2F;twelveeee"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnR3ZWx2ZWVlZTEyQGdtYWlsLmNvbQ==" title="mailto:twelveeee12@gmail.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><span class="exturl" data-url="aHR0cHM6Ly93d3cudHJhdmVsbGluZ3MuY24vZ28uaHRtbA=="><i class="ic i-paper-plane"></i>开往</span></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/Go/go%20method/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/Go/go%20generic/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a></div><span><a href="/2023/Go/go%20interface/" title="Go 接口">Go 接口</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/Lib/" title="分类于 Lib">Lib</a></div><span><a href="/2023/Go/Lib/time/" title="Go 标准库源码解析-Time">Go 标准库源码解析-Time</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/algorithm2023/" title="分类于 算法训练 2023">算法训练 2023</a></div><span><a href="/2023/AlgorithmCamp2023/13_Number/" title="13-数字">13-数字</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/Lib/" title="分类于 Lib">Lib</a></div><span><a href="/2023/Go/Lib/sort_and_container/" title="Go 标准库源码解析-sort和container">Go 标准库源码解析-sort和container</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/%E6%A0%91/" title="分类于 树">树</a></div><span><a href="/2020/DataStructure/Tree/huffman%20tree/" title="哈夫曼树">哈夫曼树</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a></div><span><a href="/2023/Go/go%20method/" title="Go 方法">Go 方法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/Search/" title="分类于 Search">Search</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/Search/Elasticsearch/" title="分类于 Elasticsearch">Elasticsearch</a></div><span><a href="/2021/Search/ElasticSearch/data_operations/" title="Elasticsearch 数据操作">Elasticsearch 数据操作</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/%E6%8E%92%E5%BA%8F/" title="分类于 排序">排序</a></div><span><a href="/2020/DataStructure/Sort/swap%20sort/" title="排序">排序</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a></div><span><a href="/2023/Go/go_goroutine_quicksort_v2/" title="Go 协程实现快排 V2">Go 协程实现快排 V2</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/Cache/" title="分类于 Cache">Cache</a></div><span><a href="/2021/Cache/mencache/" title="MemCache 简介">MemCache 简介</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2026</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Twelveeee @ Twelveeee</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">645k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">9:47</span></div><div class="beian-by"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">闽ICP备20004781号</a></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/Go/go interface/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.js?features=default,fetch"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?30195a9a0f4d22cd45e9d770a10c683f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F27X623LWT"></script><script data-pjax>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-F27X623LWT")</script>--></body></html>