<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="十二的编程笔记" href="https://blog.twelveeee.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="十二的编程笔记" href="https://blog.twelveeee.top/atom.xml"><link rel="alternate" type="application/json" title="十二的编程笔记" href="https://blog.twelveeee.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="search"><link rel="canonical" href="https://blog.twelveeee.top/2021/Search/ElasticSearch/data_operations/"><title>Elasticsearch 数据操作 - Elasticsearch - Search - 计算机科学 | Twelveeee = 十二的编程笔记 = hello world</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Elasticsearch 数据操作</h1><div class="meta"><span class="item" title="创建时间：2021-08-30 21:11:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-08-30T21:11:00+08:00">2021-08-30</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.7k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Twelveeee</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_31.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_16.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_4.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_28.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_53.webp"></li><li class="item" data-background-image="https://twelveeee-note.oss-cn-beijing.aliyuncs.com/Image/img/bgimg_22.webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computerScience/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computerScience/Search/" itemprop="item" rel="index" title="分类于 Search"><span itemprop="name">Search</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computerScience/Search/Elasticsearch/" itemprop="item" rel="index" title="分类于 Elasticsearch"><span itemprop="name">Elasticsearch</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.twelveeee.top/2021/Search/ElasticSearch/data_operations/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Twelveeee"><meta itemprop="description" content="hello world, 十二的编程笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="十二的编程笔记"></span><div class="body md" itemprop="articleBody"><h2 id="数据操作"><a class="anchor" href="#数据操作">#</a> 数据操作</h2><h3 id="集群健康"><a class="anchor" href="#集群健康">#</a> 集群健康</h3><p>运行 <code>_cat</code> API</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span><span class="token constant">X</span> <span class="token constant">GET</span> <span class="token string">"localhost:9200/_cat/health?v"</span></pre></td></tr></table></figure><p>返回内容：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>epoch      timestamp cluster       status node<span class="token punctuation">.</span>total node<span class="token punctuation">.</span>data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1475247709</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">01</span><span class="token operator">:</span><span class="token number">49</span>  elasticsearch green           <span class="token number">1</span>         <span class="token number">1</span>      <span class="token number">0</span>   <span class="token number">0</span>    <span class="token number">0</span>    <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">0</span>                  <span class="token operator">-</span>                <span class="token number">100.0</span><span class="token operator">%</span></pre></td></tr></table></figure><p><code>status</code> 字段指示着当前集群在总体上是否工作正常。它的三种颜色含义如下：<br><strong><code>green</code> </strong>: 所有的主分片和副本分片都正常运行。<br><strong><code>yellow</code> </strong>: 所有的主分片都正常运行，但不是所有的副本分片都正常运行。<br><strong><code>red</code> </strong>: 有主分片没能正常运行。</p><p>还可以获取集群中节点列表</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span><span class="token constant">X</span> <span class="token constant">GET</span> <span class="token string">"localhost:9200/_cat/nodes?v&amp;pretty"</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ip        heap<span class="token punctuation">.</span>percent ram<span class="token punctuation">.</span>percent cpu load_1m load_5m load_15m node<span class="token punctuation">.</span>role master name</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>           <span class="token number">10</span>           <span class="token number">5</span>   <span class="token number">5</span>    <span class="token number">4.46</span>                        mdi      <span class="token operator">*</span>      <span class="token constant">PB2SGZY</span></pre></td></tr></table></figure><p>有个名为 <code>PB2SGZY</code> 的节点，是集群中的单个节点。</p><p>列出所有 index</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span><span class="token constant">X</span> <span class="token constant">GET</span> <span class="token string">"localhost:9200/_cat/indices?v&amp;pretty"</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>health status index uuid pri rep docs<span class="token punctuation">.</span>count docs<span class="token punctuation">.</span>deleted store<span class="token punctuation">.</span>size pri<span class="token punctuation">.</span>store<span class="token punctuation">.</span>size</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 第二行是空，说明当前没有 index</span></pre></td></tr></table></figure><h3 id="文档"><a class="anchor" href="#文档">#</a> 文档</h3><p>就是一个存储的内容，类似于 document DB /mongoBD<br>一条信息的存储是以文档进行存储的。一次存一条文档。</p><p><code>_index</code> ：文档在哪存放<br><code>_type</code> ：文档表示的对象类别（弃用）<br><code>_id</code> ：文档唯一标识</p><h3 id="创建索引"><a class="anchor" href="#创建索引">#</a> 创建索引</h3><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">PUT</span> <span class="token operator">/</span>customer<span class="token operator">?</span>pretty</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>_cat<span class="token operator">/</span>indices<span class="token operator">?</span>v</pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>health status index    uuid                   pri rep docs<span class="token punctuation">.</span>count docs<span class="token punctuation">.</span>deleted store<span class="token punctuation">.</span>size pri<span class="token punctuation">.</span>store<span class="token punctuation">.</span>size</pre></td></tr><tr><td data-num="2"></td><td><pre>yellow open   customer 95SQ4TSUT7mWBT7VNHH67A   <span class="token number">5</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>       260b           260b</pre></td></tr></table></figure><p>回应的结果显示，现在又一个名为 <code>customer</code> 的 index，有 5 个主分片和 1 个副本（默认值），其中有 0 个文档。<br>health 是黄色，表明没有备份或者其他什么问题。因为这个新建的 index 只有一个节点在运行，在另外一个节点加入 es 集群之前，这个集群是没有备份的，如果加入了第二个节点，副本一分配，这个节点的健康状态就会变成绿色。</p><h3 id="新建文档"><a class="anchor" href="#新建文档">#</a> 新建文档</h3><p>新建文档，使用自己的 id</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">PUT</span> <span class="token operator">/</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span><span class="token operator">/</span><span class="token punctuation">&#123;</span>type<span class="token punctuation">&#125;</span><span class="token operator">/</span><span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token operator">...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果不输入 {id}，会新建一个</p><p>如果 index 不存在，es 会自动创建一个 index。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>customer<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span><span class="token operator">?</span>pretty</pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"customer"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string-property property">"found"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token string-property property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>当我们索引一个文档，怎么确认我们正在创建一个完全新的文档，而不是覆盖现有的呢？<br>请记住， _index 、 _type 和 _id 的组合可以唯一标识一个文档。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">PUT</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">123</span><span class="token operator">?</span>op_type<span class="token operator">=</span>create</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token constant">PUT</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">123</span><span class="token operator">/</span>_create</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果创建新文档的请求成功执行，Elasticsearch 会返回元数据和一个 <code>201 Created</code> 的 HTTP 响应码。</p><p>另一方面，如果具有相同的 <code>_index</code> 、 <code>_type</code> 和 <code>_id</code> 的文档已经存在，Elasticsearch 将会返回 <code>409 Conflict</code> 响应码，以及如下的错误信息：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"document_already_exists_exception"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[blog][123]: document already exists"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token string-property property">"shard"</span><span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"website"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"document_already_exists_exception"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[blog][123]: document already exists"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token string-property property">"shard"</span><span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"website"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">409</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="删除文档"><a class="anchor" href="#删除文档">#</a> 删除文档</h3><p><strong>删除索引</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">DELETE</span> <span class="token operator">/</span>customer<span class="token operator">?</span>pretty</pre></td></tr></table></figure><p>和删除文档一样</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">DELETE</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">123</span></pre></td></tr></table></figure><p>如果找到该文档，Elasticsearch 将要返回一个 <code>200 ok</code> 的 HTTP 响应码，和一个类似以下结构的响应体。注意，字段 <code>_version</code> 值已经增加:</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"found"</span> <span class="token operator">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string-property property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果文档没有找到，我们将得到 <code>404 Not Found</code> 的响应码和类似这样的响应体：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"found"</span> <span class="token operator">:</span>    <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string-property property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>即使文档不存在（ <code>Found</code> 是 <code>false</code> ）， <code>_version</code> 值仍然会增加。这是 Elasticsearch 内部记录本的一部分，用来确保这些改变在跨多节点时以正确的顺序执行。</p><h3 id="更新文档"><a class="anchor" href="#更新文档">#</a> 更新文档</h3><p>在 Elasticsearch 里文档是 <em>不可改变</em> 的，不能修改它们。相反，如果想要更新现有的文档，需要 <em>重建索引</em> 或者进行替换，比如删掉一个再新建一个。</p><pre><code class="language-sense">PUT /website/blog/123
&#123;
  &quot;title&quot;: &quot;My first blog entry&quot;,
  &quot;text&quot;:  &quot;I am starting to get the hang of this...&quot;,
  &quot;date&quot;:  &quot;2014/01/02&quot;
&#125;
</code></pre><p>在响应体中，我们能看到 Elasticsearch 已经增加了 <code>_version</code> 字段值：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string-property property">"created"</span><span class="token operator">:</span>   <span class="token boolean">false</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>created</code> 标志设置成 <code>false</code> ，是因为相同的索引、类型和 ID 的文档已经存在。</p><p>在内部，Elasticsearch 已将旧文档标记为已删除，并增加一个全新的文档。 尽管你不能再对旧版本的文档进行访问，但它并不会立即消失。当继续索引更多的数据，Elasticsearch 会在后台清理这些已删除文档。</p><p>也可以使用简单的脚本执行更新，例如将年龄 + 5</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">POST</span> <span class="token operator">/</span>customer<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>_update<span class="token operator">?</span>pretty</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"script"</span> <span class="token operator">:</span> <span class="token string">"ctx._source.age += 5"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="简单查询文档"><a class="anchor" href="#简单查询文档">#</a> 简单查询文档</h3><p>为了从 Elasticsearch 中检索出文档，我们仍然使用相同的 <code>_index</code> , <code>_id</code> ，但是 HTTP 谓词更改为 <code>GET</code> :</p><p><strong>参数方式请求</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search<span class="token operator">?</span>q<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">&amp;</span>sort<span class="token operator">=</span>account_number<span class="token operator">:</span>asc<span class="token operator">&amp;</span>pretty</pre></td></tr></table></figure><p><code>q=\*</code> 参数指示 es 匹配索引中的所有文档<br><code>sort=account_number:asc</code> 尝试知名对 account_number 升序排序，<br><code>pretty</code> 表示返回便于识别的 json 字符串</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"took"</span> <span class="token operator">:</span> <span class="token number">63</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string-property property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string-property property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string-property property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string-property property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token string-property property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token string-property property">"total"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string-property property">"max_score"</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token string-property property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token string-property property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token string-property property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token string-property property">"_score"</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token string-property property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"account_number"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string-property property">"balance"</span><span class="token operator">:</span><span class="token number">16623</span><span class="token punctuation">,</span><span class="token string-property property">"firstname"</span><span class="token operator">:</span><span class="token string">"Bradshaw"</span><span class="token punctuation">,</span><span class="token string-property property">"lastname"</span><span class="token operator">:</span><span class="token string">"Mckenzie"</span><span class="token punctuation">,</span><span class="token string-property property">"age"</span><span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token string-property property">"gender"</span><span class="token operator">:</span><span class="token string">"F"</span><span class="token punctuation">,</span><span class="token string-property property">"address"</span><span class="token operator">:</span><span class="token string">"244 Columbus Place"</span><span class="token punctuation">,</span><span class="token string-property property">"employer"</span><span class="token operator">:</span><span class="token string">"Euron"</span><span class="token punctuation">,</span><span class="token string-property property">"email"</span><span class="token operator">:</span><span class="token string">"bradshawmckenzie@euron.com"</span><span class="token punctuation">,</span><span class="token string-property property">"city"</span><span class="token operator">:</span><span class="token string">"Hobucken"</span><span class="token punctuation">,</span><span class="token string-property property">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token string-property property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token string-property property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token string-property property">"_score"</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token string-property property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"account_number"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string-property property">"balance"</span><span class="token operator">:</span><span class="token number">39225</span><span class="token punctuation">,</span><span class="token string-property property">"firstname"</span><span class="token operator">:</span><span class="token string">"Amber"</span><span class="token punctuation">,</span><span class="token string-property property">"lastname"</span><span class="token operator">:</span><span class="token string">"Duke"</span><span class="token punctuation">,</span><span class="token string-property property">"age"</span><span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string-property property">"gender"</span><span class="token operator">:</span><span class="token string">"M"</span><span class="token punctuation">,</span><span class="token string-property property">"address"</span><span class="token operator">:</span><span class="token string">"880 Holmes Lane"</span><span class="token punctuation">,</span><span class="token string-property property">"employer"</span><span class="token operator">:</span><span class="token string">"Pyrami"</span><span class="token punctuation">,</span><span class="token string-property property">"email"</span><span class="token operator">:</span><span class="token string">"amberduke@pyrami.com"</span><span class="token punctuation">,</span><span class="token string-property property">"city"</span><span class="token operator">:</span><span class="token string">"Brogan"</span><span class="token punctuation">,</span><span class="token string-property property">"state"</span><span class="token operator">:</span><span class="token string">"IL"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token operator">...</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>响应体：<br><code>took</code> : es 的执行搜索时间 单位 ms<br><code>time_out</code> : 是否超时<br><code>_shards</code> : 搜索了多少个分片，搜索成功和失败的分片数。<br><code>hits</code> : 搜索结果<br><code>hits.total</code> : 搜索结果的数量<br><code>hits.hits</code> : 实际搜索结果数组<br><code>hits.sort</code> : 结果的排序键</p><p>不同于上面的参数方式请求，这是请求体方式请求，就是把查询的内容放入 json body 中。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span> <span class="token string-property property">"account_number"</span><span class="token operator">:</span> <span class="token string">"asc"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>请求体方式请求</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"order"</span><span class="token operator">:</span> <span class="token string">"desc"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string-property property">"from"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>match_all</code> : 查询索引内部所有文档。<br><code>sort</code> : 排序<br><code>from、size</code> : 类似于 mysql <code>limit 10,5</code><br>如果 size 未指定，默认是 10，</p><p><strong>返回一部分文档</strong></p><p>默认情况下， <code>GET</code> 请求会返回整个文档，这个文档正如存储在 <code>_source</code> 字段中的一样。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">123</span><span class="token operator">?</span>_source<span class="token operator">=</span>title<span class="token punctuation">,</span>text</pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string-property property">"found"</span> <span class="token operator">:</span>   <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token string-property property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"My first blog entry"</span> <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token string-property property">"text"</span><span class="token operator">:</span>  <span class="token string">"Just trying this out..."</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果只要 source 字段，不要元数据</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">123</span><span class="token operator">/</span>_source</pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"My first blog entry"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token string-property property">"text"</span><span class="token operator">:</span>  <span class="token string">"Just trying this out..."</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token string-property property">"date"</span><span class="token operator">:</span>  <span class="token string">"2014/01/01"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>bool 查询</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string-property property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token string-property property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#123;</span> <span class="token string-property property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#123;</span> <span class="token string-property property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"address"</span><span class="token operator">:</span> <span class="token string">"lane"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>must</code> 子语句里面的所有条件都必须满足才是匹配的数据。</p><p>相反的，还有一个 <code>must_not</code></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string-property property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token string-property property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#123;</span> <span class="token string-property property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#123;</span> <span class="token string-property property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"address"</span><span class="token operator">:</span> <span class="token string">"lane"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>must_not</code> 内的语句必须全不满足才是匹配的数据。</p><p><code>bool</code> 里允许混合条件，也就是同时使用 must 和 must_not、should</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string-property property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token string-property property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#123;</span> <span class="token string-property property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"age"</span><span class="token operator">:</span> <span class="token string">"40"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token string-property property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#123;</span> <span class="token string-property property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"ID"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>bool</code> 里还有 <code>filter</code></p><p>用于过滤文档</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//eg 选取余额大于 20000，小于 30000 的文档</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string-property property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token string-property property">"must"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token string-property property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string-property property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>          <span class="token string-property property">"balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token string-property property">"gte"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token string-property property">"lte"</span><span class="token operator">:</span> <span class="token number">30000</span></pre></td></tr><tr><td data-num="12"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>聚合 (group by)</p><p>对数据进行分组和统计信息，就跟 mysql 一样，近似于 sql group by</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string-property property">"group_by_state"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token string-property property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"state.keyword"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>等同于</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> state<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> bank <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> state <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>response</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"took"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string-property property">"total"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string-property property">"successful"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string-property property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string-property property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token string-property property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token string-property property">"total"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string-property property">"max_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token string-property property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token string-property property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token string-property property">"group_by_state"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token string-property property">"doc_count_error_upper_bound"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token string-property property">"sum_other_doc_count"</span><span class="token operator">:</span> <span class="token number">770</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token string-property property">"buckets"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"ID"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">27</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">27</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"AL"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">25</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"MD"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">25</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"TN"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">23</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"MA"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">21</span></pre></td></tr><tr><td data-num="37"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"NC"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">21</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"ND"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">21</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"ME"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">20</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"MO"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token string-property property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">20</span></pre></td></tr><tr><td data-num="49"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>对余额进行排序</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string-property property">"group_by_state"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token string-property property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"state.keyword"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token string-property property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string-property property">"average_balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>          <span class="token string-property property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>降序排序平均余额</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>bank<span class="token operator">/</span>_search</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string-property property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string-property property">"group_by_state"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token string-property property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"state.keyword"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string-property property">"order"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>          <span class="token string-property property">"average_balance"</span><span class="token operator">:</span> <span class="token string">"desc"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token string-property property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string-property property">"average_balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>          <span class="token string-property property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>检查文档是否存在</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span>i <span class="token operator">-</span><span class="token constant">XHEAD</span> <span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">123</span></pre></td></tr></table></figure><p>如果文档存在， Elasticsearch 将返回一个 <code>200 ok</code> 的状态码：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> <span class="token constant">OK</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Content<span class="token operator">-</span>Type<span class="token operator">:</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span> charset<span class="token operator">=</span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Content<span class="token operator">-</span>Length<span class="token operator">:</span> <span class="token number">0</span></pre></td></tr></table></figure><p>若文档不存在， Elasticsearch 将返回一个 <code>404 Not Found</code> 的状态码：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span>i <span class="token operator">-</span><span class="token constant">XHEAD</span> <span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">124</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">404</span> Not Found</pre></td></tr><tr><td data-num="2"></td><td><pre>Content<span class="token operator">-</span>Type<span class="token operator">:</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span> charset<span class="token operator">=</span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Content<span class="token operator">-</span>Length<span class="token operator">:</span> <span class="token number">0</span></pre></td></tr></table></figure><p>当然，一个文档仅仅是在检查的时候不存在，并不意味着一毫秒之后它也不存在：也许同时正好另一个进程就创建了该文档。</p><h3 id="批量查询文档"><a class="anchor" href="#批量查询文档">#</a> 批量查询文档</h3><p>将多个请求合并成一个，避免单独处理每个请求花费的网络延时和开销。 如果你需要从 Elasticsearch 检索很多文档，那么使用 <em>multi-get</em> 或者 <code>mget</code> API 来将这些检索请求放在一个请求中，将比逐个文档请求更快地检索到全部文档。</p><p><code>mget</code> API 要求有一个 <code>docs</code> 数组作为参数，每个元素包含需要检索文档的元数据， 包括 <code>_index</code> 、 <code>_type</code> 和 <code>_id</code> 。如果你想检索一个或者多个特定的字段，那么你可以通过 <code>_source</code> 参数来指定这些字段的名字：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>_mget</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token string-property property">"docs"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>         <span class="token string-property property">"_type"</span> <span class="token operator">:</span>  <span class="token string">"blog"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>         <span class="token string-property property">"_id"</span> <span class="token operator">:</span>    <span class="token number">2</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>         <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>         <span class="token string-property property">"_type"</span> <span class="token operator">:</span>  <span class="token string">"pageviews"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token string-property property">"_id"</span> <span class="token operator">:</span>    <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>         <span class="token string-property property">"_source"</span><span class="token operator">:</span> <span class="token string">"views"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>   <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>该响应体也包含一个 <code>docs</code> 数组， 对于每一个在请求中指定的文档，这个数组中都包含有一个对应的响应，且顺序与请求中的顺序相同。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token string-property property">"docs"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>         <span class="token string-property property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         <span class="token string-property property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"2"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>         <span class="token string-property property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>         <span class="token string-property property">"found"</span> <span class="token operator">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>         <span class="token string-property property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token string-property property">"text"</span> <span class="token operator">:</span>  <span class="token string">"This is a piece of cake..."</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token string-property property">"title"</span> <span class="token operator">:</span> <span class="token string">"My first external blog entry"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>         <span class="token string-property property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>         <span class="token string-property property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>         <span class="token string-property property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"pageviews"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>         <span class="token string-property property">"found"</span> <span class="token operator">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>         <span class="token string-property property">"_version"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>         <span class="token string-property property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token string-property property">"views"</span> <span class="token operator">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="22"></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>   <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果想检索的数据都在相同的 <code>_index</code> 中（甚至相同的 <code>_type</code> 中），则可以在 URL 中指定默认的 <code>/_index</code> 或者默认的 <code>/_index/_type</code> 。</p><p>你仍然可以通过单独请求覆盖这些值：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span>_mget</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token string-property property">"docs"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token punctuation">&#123;</span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token punctuation">&#123;</span> <span class="token string-property property">"_type"</span> <span class="token operator">:</span> <span class="token string">"pageviews"</span><span class="token punctuation">,</span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span>   <span class="token number">1</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果所有文档的 <code>_index</code> 和 <code>_type</code> 都是相同的，你可以只传一个 <code>ids</code> 数组，而不是整个 <code>docs</code> 数组：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">GET</span> <span class="token operator">/</span>website<span class="token operator">/</span>blog<span class="token operator">/</span>_mget</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token string-property property">"ids"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>即使有某个文档没有找到，上述请求的 HTTP 状态码仍然是 <code>200</code> 。事实上，即使请求 <em>没有</em> 找到任何文档，它的状态码依然是 <code>200</code> -- 因为 <code>mget</code> 请求本身已经成功执行。 为了确定某个文档查找是成功或者失败，你需要检查 <code>found</code> 标记。</p><h3 id="批量操作"><a class="anchor" href="#批量操作">#</a> 批量操作</h3><p>与 <code>mget</code> 可以使我们一次取回多个文档同样的方式， <code>bulk</code> API 允许在单个步骤中进行多次 <code>create</code> 、 <code>index</code> 、 <code>update</code> 或 <code>delete</code> 请求。 如果你需要索引一个数据流比如日志事件，它可以排队和索引数百或数千批次。</p><p><code>bulk</code> 与其他的请求体格式稍有不同，如下所示：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> metadata <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>\n</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> request body        <span class="token punctuation">&#125;</span>\n</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> metadata <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>\n</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> request body        <span class="token punctuation">&#125;</span>\n</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">...</span></pre></td></tr></table></figure><p>这种格式类似一个有效的单行 JSON 文档 <em>流</em> ，它通过换行符 ( <code>\n</code> ) 连接到一起。注意两个要点：<br>每行一定要以换行符 ( <code>\n</code> ) 结尾， <em>包括最后一行</em> 。这些换行符被用作一个标记，可以有效分隔行。<br>这些行不能包含未转义的换行符，因为他们将会对解析造成干扰。这意味着这个 JSON <em>不</em> 能使用 pretty 参数打印。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">POST</span> <span class="token operator">/</span>_bulk</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"delete"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token string-property property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"create"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token string-property property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"title"</span><span class="token operator">:</span>    <span class="token string">"My first blog post"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"index"</span><span class="token operator">:</span>  <span class="token punctuation">&#123;</span> <span class="token string-property property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token string-property property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"title"</span><span class="token operator">:</span>    <span class="token string">"My second blog post"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"update"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token string-property property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span> <span class="token string-property property">"_retry_on_conflict"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string-property property">"doc"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"title"</span> <span class="token operator">:</span> <span class="token string">"My updated blog post"</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>delete</code> 动作不能有请求体，它后面跟着的是另外一个操作。<br>最后一个换行符不要落下。</p><div class="tags"><a href="/tags/search/" rel="tag"><i class="ic i-tag"></i> search</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-10-12 19:14:14" itemprop="dateModified" datetime="2024-10-12T19:14:14+08:00">2024-10-12</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Twelveeee <i class="ic i-at"><em>@</em></i>十二的编程笔记</li><li class="link"><strong>本文链接：</strong> <a href="https://blog.twelveeee.top/2021/Search/ElasticSearch/data_operations/" title="Elasticsearch 数据操作">https://blog.twelveeee.top/2021/Search/ElasticSearch/data_operations/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/Search/ElasticSearch/basic_usage/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;twelveeee-note.oss-cn-beijing.aliyuncs.com&#x2F;Image&#x2F;img&#x2F;bgimg_5.webp" title="Elasticsearch 基础使用"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Elasticsearch</span><h3>Elasticsearch 基础使用</h3></a></div><div class="item right"><a href="/2021/Search/ElasticSearch/data_operations_concurrent/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;twelveeee-note.oss-cn-beijing.aliyuncs.com&#x2F;Image&#x2F;img&#x2F;bgimg_37.webp" title="Elasticsearch 并发处理"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Elasticsearch</span><h3>Elasticsearch 并发处理</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">数据操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7"><span class="toc-number">1.1.</span> <span class="toc-text">集群健康</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.2.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">1.4.</span> <span class="toc-text">新建文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">1.5.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-number">1.6.</span> <span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">1.7.</span> <span class="toc-text">简单查询文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">1.8.</span> <span class="toc-text">批量查询文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.9.</span> <span class="toc-text">批量操作</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/Search/ElasticSearch/intro/" rel="bookmark" title="Elasticsearch 简介">Elasticsearch 简介</a></li><li><a href="/2021/Search/ElasticSearch/basic_usage/" rel="bookmark" title="Elasticsearch 基础使用">Elasticsearch 基础使用</a></li><li class="active"><a href="/2021/Search/ElasticSearch/data_operations/" rel="bookmark" title="Elasticsearch 数据操作">Elasticsearch 数据操作</a></li><li><a href="/2021/Search/ElasticSearch/mapping/" rel="bookmark" title="Elasticsearch 映射">Elasticsearch 映射</a></li><li><a href="/2021/Search/ElasticSearch/data_analysis/" rel="bookmark" title="Elasticsearch 分析">Elasticsearch 分析</a></li><li><a href="/2021/Search/ElasticSearch/The_difference_with_mongoDB/" rel="bookmark" title="Elasticsearch 与 mongoDB 的区别">Elasticsearch 与 mongoDB 的区别</a></li><li><a href="/2021/Search/ElasticSearch/The_principle_of_the_cluster/" rel="bookmark" title="Elasticsearch 集群的原理">Elasticsearch 集群的原理</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Twelveeee" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Twelveeee</p><div class="description" itemprop="description">十二的编程笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">115</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">30</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">26</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R3ZWx2ZWVlZQ==" title="https:&#x2F;&#x2F;github.com&#x2F;twelveeee"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnR3ZWx2ZWVlZTEyQGdtYWlsLmNvbQ==" title="mailto:twelveeee12@gmail.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><span class="exturl" data-url="aHR0cHM6Ly93d3cudHJhdmVsbGluZ3MuY24vZ28uaHRtbA=="><i class="ic i-paper-plane"></i>开往</span></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/Search/ElasticSearch/basic_usage/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/Search/ElasticSearch/data_operations_concurrent/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/Project/" title="分类于 Project">Project</a></div><span><a href="/2024/Project/copilot-gpt4-service/" title="搭建使用github copilot的 ChatGPT Next Web">搭建使用github copilot的 ChatGPT Next Web</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/%E6%9F%A5%E6%89%BE/" title="分类于 查找">查找</a></div><span><a href="/2020/DataStructure/Search/tree-table%20search/" title="树表式查找法">树表式查找法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/Lib/" title="分类于 Lib">Lib</a></div><span><a href="/2023/Go/Lib/urfave_cli/" title="Go urfave cli 使用">Go urfave cli 使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/algorithm2023/" title="分类于 算法训练 2023">算法训练 2023</a></div><span><a href="/2023/AlgorithmCamp2023/14_Heap/" title="14-堆">14-堆</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/algorithm2023/" title="分类于 算法训练 2023">算法训练 2023</a></div><span><a href="/2023/AlgorithmCamp2023/12_String/" title="12-字符串">12-字符串</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/C/" title="分类于 C">C</a></div><span><a href="/2020/C/C%20note/" title="C语言个人笔记">C语言个人笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/%E7%BA%BF%E6%80%A7%E8%A1%A8/" title="分类于 线性表">线性表</a></div><span><a href="/2020/DataStructure/List/singly%20linked%20list/" title="单链表">单链表</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/Cache/" title="分类于 Cache">Cache</a></div><span><a href="/2021/Cache/LocalCache/" title="LocalCache 简介">LocalCache 简介</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/GO/" title="分类于 GO">GO</a></div><span><a href="/2023/Go/go%20statement/" title="Go 语句">Go 语句</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computerScience/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/computerScience/dataStructure/%E7%BA%BF%E6%80%A7%E8%A1%A8/" title="分类于 线性表">线性表</a></div><span><a href="/2020/DataStructure/List/doubly%20linked%20list/" title="循环链表">循环链表</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Twelveeee @ Twelveeee</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">586k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">8:53</span></div><div class="beian-by"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">闽ICP备20004781号</a></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/Search/ElasticSearch/data_operations/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?30195a9a0f4d22cd45e9d770a10c683f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F27X623LWT"></script><script data-pjax>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-F27X623LWT")</script>--></body></html>